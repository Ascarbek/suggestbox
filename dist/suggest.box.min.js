!function(){"use strict";angular.module("azSuggestBox",[])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbDropdownItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,n,s){var l=[],o=e.listAlias,c=t.parent();e.highlightedItem=-1,e.$watch("isOpen",function(){e.isOpen?c.removeClass("ng-hide"):c.addClass("ng-hide")}),e.$watchCollection("list",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var n=0;n<e.list.length;n++){var c=e.list[n],r=e.$new();r[o]=c,r.$index=n,r.$first=0==n,r.$last=n==e.list.length-1,s(r,function(e,i){i.hidden=!1,i.hide=function(){angular.element(e).addClass("ng-hide"),i.hidden=!0},i.show=function(){angular.element(e).removeClass("ng-hide"),i.hidden=!1},i.selected=!1,i.select=function(){angular.element(e).addClass(i.sbSelectedListItemClass),i.selected=!0},i.unSelect=function(){angular.element(e).removeClass(i.sbSelectedListItemClass),i.selected=!1},i.isSelected=function(){return i.selected},i.highlight=function(){angular.element(e).addClass("sb-list-item-highlight")},i.unHighlight=function(){angular.element(e).removeClass("sb-list-item-highlight")},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e),e.on("click",function(){i.toggleItemSelection(i.$index),i.$apply()})})}}),e.toggleItemSelection=function(t){if(1==e.sbMaxSelection&&(e.indexes.forEach(function(t){e.unSelectListItem(t)}),e.indexes.splice(0,e.indexes.length),e.model.splice(0,e.model.length)),e.sbAllowDuplicates)e.indexes.push(t),e.model.push(e.list[t]),e.model[e.model.length-1].$listIndex=t;else{for(var i=!1,n=0;n<e.indexes.length;n++)if(e.indexes[n]===t){e.indexes.splice(n,1),e.unSelectListItem(t),i=!0;break}if(i)for(var s=0;s<e.model.length;s++)e.model[s].$listIndex==t&&e.model.splice(s,1);i||(e.indexes.push(t),e.model.push(e.list[t]),e.model[e.model.length-1].$listIndex=t,e.highlightNone())}},e.highlightNone=function(){e.highlightedItem>-1&&(l[e.highlightedItem].scope.unHighlight(),e.highlightedItem=-1)},e.hideListItem=function(t){t==e.highlightedItem&&(l[t].scope.unHighlight(),e.highlightedItem=-1),l[t].scope.hide()},e.showListItem=function(e){l[e]&&l[e].scope.show()},e.unSelectListItem=function(e){l[e].scope.unSelect()},e.selectListItem=function(t){l[t]&&(t==e.highlightedItem&&l[t].scope.unHighlight(),l[t].scope.select())},e.getSearchResultsCount=function(){for(var e=0,t=0;t<l.length;t++)l[t].scope.hidden||e++;return e},e.getListItemsCount=function(){return l.length},e.highlightListItem=function(t){e.highlightedItem>-1&&l[e.highlightedItem].scope.unHighlight(),l[t].scope.highlight(),e.highlightedItem=t},e.highlightNextItem=function(){var t=0,i=e.highlightedItem;do t++,i++,i>=l.length&&(i=0);while(t<l.length&&l[i].scope.hidden);e.highlightListItem(i)},e.highlightPrevItem=function(){var t=0,i=e.highlightedItem;do t++,i--,-1>=i&&(i=l.length-1);while(t<l.length&&l[i].scope.hidden);e.highlightListItem(i)}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbRemoveItemFromSelection",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sbRemoveItemFromSelection(),e.$apply()})}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbSelectionItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,n,s){var l=[],o=e.indexesAlias;e.$watchCollection("model",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var n=0;n<e.model.length;n++){var c={},r=e.$new();c=e.model[n],r[o]=c,r.$index=n,s(r,function(e,i){i.sbRemoveItemFromSelection=function(){if(i[o].$listIndex){i.unSelectListItem(i[o].$listIndex);for(var e=0;e<i.indexes.length;e++)if(i[o].$listIndex==i.indexes[e]){i.indexes.splice(e,1);break}}i.model.splice(i.$index,1)},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e)})}}),e.getSelectionCount=function(){return e.model.length}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("azSuggestBox",[function(){return{transclude:!0,restrict:"AE",scope:{listAlias:"@sbListItemAlias",list:"=sbList",indexesAlias:"@sbModelAlias",model:"=sbModel",indexes:"=sbSelectedIndexes",sbMaxSelection:"=",sbAllowDuplicates:"=",sbAllowFreeText:"=",sbAllowAddItem:"=",sbNewItemField:"@",sbSearchField:"@",sbSelectFirstListItem:"=",sbBroadcastEventName:"@",sbSelectedListItemClass:"@",sbCloseListOnSelect:"=",sbOnSelectionChange:"&"},link:function(e){e.init()},controller:["$window","$rootScope","$scope","$element","$transclude","$timeout",function(e,t,i,n,s,l){i.init=function(){if(void 0===i.list)throw"sb-list attribute must be set";i.listAlias=i.listAlias||"i",i.indexesAlias=i.indexesAlias||"s",i.indexes=i.indexes||[],i.model=i.model||[],i.sbMaxSelection=i.sbMaxSelection||0,i.sbAllowDuplicates=i.sbAllowDuplicates||!1,i.sbAllowFreeText=i.sbAllowFreeText||!1,i.sbAllowAddItem=i.sbAllowAddItem||!1,i.sbNewItemField=i.sbNewItemField||"name",i.sbSearchField=i.sbSearchField||!1,i.sbSelectFirstListItem=i.sbSelectFirstListItem||!1,i.sbBroadcastEventName=i.sbBroadcastEventName||"azSuggestBoxSelect",i.sbSelectedListItemClass=i.sbSelectedListItemClass||"ng-hide",i.sbCloseListOnSelect=i.sbCloseListOnSelect||!1,i.weSentBroadcast=!1,i.closeDropDown=function(){i.isOpen=!1},i.openDropDown=function(){i.isOpen=!0},i.dropDownState=function(){return i.isOpen},s(i,function(e,t){t.closeDropDown(),t.$watch("isOpen",function(){t.isOpen?n.addClass("open"):n.removeClass("open")}),n.append(e)}),i.$watchCollection("list",function(){for(var e=0;e<i.list.length;e++)if("object"!=typeof i.list[e])throw"sb-list array items should be objects"}),i.skipSyncIndex=!1,i.skipSyncModel=!1,i.$watchCollection("indexes",function(){if(i.sbCloseListOnSelect&&(i.closeDropDown(),i.highlightNone(),i.$broadcast("clearSearch")),!i.sbAllowDuplicates){for(var e=0;e<i.list.length;e++)i.unSelectListItem(e);i.indexes.forEach(function(e){i.selectListItem(e)})}if(i.skipSyncIndex)i.skipSyncIndex=!1;else{for(var t=[],n=0;n<i.model.length;n++)"number"==typeof i.model[n].$listIndex&&(-1==i.indexes.indexOf(i.model[n].$listIndex)?(i.model.splice(n,1),n--):t[i.model[n].$listIndex]=!0);for(var s=0;s<i.indexes.length;s++)t[i.indexes[s]]||(i.model.push(i.list[i.indexes[s]]),i.model[i.model.length-1].$listIndex=i.indexes[s])}}),i.$watchCollection("model",function(){if(i.sbOnSelectionChange(),i.skipSyncModel)i.skipSyncModel=!1;else{i.skipSyncIndex=!0,i.indexes.splice(0,i.indexes.length);for(var e=0;e<i.model.length;e++){for(var t=!1,n=-1,s=0;s<i.list.length;s++){var l=!0,o=i.list[s],c=i.model[e];for(var r in o)if(o[r]!==c[r]){l=!1;break}if(l){t=!0,n=s;break}}t?(i.model[e].$listIndex=n,i.indexes.push(n)):i.model[e].$isNew=!0}}}),e.onclick=function(e){var n=e.target,s=!1;do{if(n.attributes&&(n.attributes["az-suggest-box"]||n.attributes["sb-selection-item"]||n.attributes["sb-trigger-area"])){s=!0;break}n=n.parentNode}while(void 0!=n);s||t.$broadcast(i.sbBroadcastEventName)},i.$on(i.sbBroadcastEventName,function(){i.weSentBroadcast||i.closeDropDown(),i.weSentBroadcast=!1,i.$apply()})}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTriggerArea",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sendBroadcast(),e.dropDownState()?e.closeDropDown():e.openDropDown(),e.$apply()})},controller:["$rootScope","$scope",function(e,t){t.sendBroadcast=function(){t.weSentBroadcast=!0,e.$broadcast(t.sbBroadcastEventName)}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTypeAhead",[function(){return{restrict:"A",link:function(e,t,i,n){function s(){e.openDropDown();var i=t.val().toLowerCase(),n=0,s=-1;e.highlightNone();for(var l=0;l<e.list.length;l++)if(0==i.length)e.showListItem(l),n++,s=l;else{var o=e.list[l];if("object"==typeof o){for(var c in o)if(o.hasOwnProperty(c)){var r;if("string"==typeof o[c])r=o[c].toLowerCase();else{if("number"!=typeof o[c])continue;r=o[c].toString()}if(r.search(new RegExp(i))>-1){e.showListItem(l),-1==e.indexes.indexOf(l)&&(n++,s=l);break}e.hideListItem(l)}}else if("string"==typeof o){if(o.toLowerCase().search(new RegExp(i))>-1){e.showListItem(l),n++,s=l;break}e.hideListItem(l)}else if("number"==typeof o){if(o.toString().search(new RegExp(i))>-1){e.showListItem(l),n++,s=l;break}e.hideListItem(l)}}e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t),s==t&&(s=-1,n=2)}),1==n&&e.highlightListItem(s)}t.on("keydown",function(i){switch(i.keyCode){case 40:e.openDropDown(),e.highlightNextItem(),i.preventDefault();break;case 38:e.highlightPrevItem(),i.preventDefault();break;case 13:case 9:if(e.highlightedItem>-1)e.toggleItemSelection(e.highlightedItem);else if(e.sbAllowFreeText&&t.val().length>0){var n={};n[e.sbNewItemField]=t.val(),n.$isNew=!0,e.sbAllowAddItem?(e.list.splice(e.list.length,0,n),e.toggleItemSelection(e.list.length-1)):e.model.push(n)}9==i.keyCode&&(e.closeDropDown(),e.highlightNone(),e.$broadcast("clearSearch"));break;case 27:e.closeDropDown(),e.$emit("clearSearch"),i.preventDefault();break;case 8:0==t.val().length&&(e.model[e.model.length-1].$isNew?e.model.pop():(e.unSelectListItem(e.indexes.pop()),e.model.pop()))}e.$apply()}),t.on("input",function(){s()}),e.$on("clearSearch",function(){t.val("");for(var i=0;i<e.list.length;i++)e.showListItem(i);e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t)})})}}}])}();