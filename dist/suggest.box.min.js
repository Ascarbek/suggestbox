!function(){"use strict";angular.module("azSuggestBox",[])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbDropdownItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,n,o){var l=[],s=e.listAlias,c=t.parent();e.highlightedItem=-1,e.$watch("isOpen",function(){e.isOpen?c.removeClass("ng-hide"):c.addClass("ng-hide")}),e.$watchCollection("list",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var n=0;n<e.list.length;n++){var c=e.list[n],a=e.$new();a[s]=c,a.$index=n,a.$first=0==n,a.$last=n==e.list.length-1,o(a,function(e,i){i.hidden=!1,i.hide=function(){angular.element(e).addClass("ng-hide"),i.hidden=!0},i.show=function(){angular.element(e).removeClass("ng-hide"),i.hidden=!1},i.selected=!1,i.select=function(){angular.element(e).addClass(i.sbSelectedListItemClass),i.selected=!0},i.unSelect=function(){angular.element(e).removeClass(i.sbSelectedListItemClass),i.selected=!1},i.highlight=function(){angular.element(e).addClass("sb-list-item-highlight")},i.unHighlight=function(){angular.element(e).removeClass("sb-list-item-highlight")},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e),e.on("click",function(){i.toggleItemSelection(i.$index),i.$apply()})})}}),e.toggleItemSelection=function(t){if(1==e.sbMaxSelection&&(e.model.forEach(function(t){"number"==typeof t&&e.unSelectListItem(t)}),e.model.splice(0,e.model.length)),e.sbAllowDuplicates)e.model.push(t);else{for(var i=!1,n=0;n<e.model.length;n++)if(e.model[n]===t){e.model.splice(n,1),e.unSelectListItem(t),i=!0;break}i||e.model.push(t)}},e.highlightNone=function(){e.highlightedItem>-1&&(l[e.highlightedItem].scope.unHighlight(),e.highlightedItem=-1)},e.hideListItem=function(t){t==e.highlightedItem&&(l[t].scope.unHighlight(),e.highlightedItem=-1),l[t].scope.hide()},e.showListItem=function(e){l[e]&&l[e].scope.show()},e.unSelectListItem=function(e){l[e].scope.unSelect()},e.selectListItem=function(t){l[t]&&(t==e.highlightedItem&&l[t].scope.unHighlight(),l[t].scope.select())},e.getSearchResultsCount=function(){for(var e=0,t=0;t<l.length;t++)l[t].scope.hidden||e++;return e},e.getListItemsCount=function(){return l.length},e.highlightListItem=function(t){e.highlightedItem>-1&&l[e.highlightedItem].scope.unHighlight(),l[t].scope.highlight(),e.highlightedItem=t},e.highlightNextItem=function(){var t=0,i=e.highlightedItem;do t++,i++,i>=l.length&&(i=0);while(t<l.length&&l[i].scope.hidden);e.highlightListItem(i)},e.highlightPrevItem=function(){var t=0,i=e.highlightedItem;do t++,i--,-1>=i&&(i=l.length-1);while(t<l.length&&l[i].scope.hidden);e.highlightListItem(i)}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbRemoveItemFromSelection",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sbRemoveItemFromSelection(),e.$apply()})}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbSelectionItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,n,o){var l=[],s=e.modelAlias;e.$watchCollection("model",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var n=0;n<e.model.length;n++){var c={},a=e.$new();"number"==typeof e.model[n]?(c=e.list[e.model[n]],a.$itemId=e.model[n]):c[e.sbNewItemField]=e.model[n],a[s]=c,a.$index=n,o(a,function(e,i){i.sbRemoveItemFromSelection=function(){(!i.sbAllowFreeText||i.sbAllowAddItem)&&i.unSelectListItem(i.$itemId),i.model.splice(i.$index,1)},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e)})}}),e.getSelectionCount=function(){return e.model.length}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("azSuggestBox",[function(){return{transclude:!0,restrict:"AE",scope:{sbList:"@",sbModel:"@",sbMaxSelection:"=",sbAllowDuplicates:"=",sbAllowFreeText:"=",sbAllowAddItem:"=",sbNewItemField:"@",sbSearchField:"@",sbSelectFirstListItem:"=",sbBroadcastEventName:"@",sbSelectedListItemClass:"@",sbCloseListOnSelect:"=",sbOnSelectionChange:"&"},link:function(e){e.init()},controller:["$window","$rootScope","$scope","$element","$transclude","$timeout",function(e,t,i,n,o,l){i.init=function(){if(void 0===i.sbList)throw"sb-list attribute must be set";if(void 0===i.sbModel)throw"sb-model attribute must be set";i.sbMaxSelection=i.sbMaxSelection||0,i.sbAllowDuplicates=i.sbAllowDuplicates||!1,i.sbAllowFreeText=i.sbAllowFreeText||!1,i.sbAllowAddItem=i.sbAllowAddItem||!1,i.sbNewItemField=i.sbNewItemField||"name",i.sbSearchField=i.sbSearchField||!1,i.sbSelectFirstListItem=i.sbSelectFirstListItem||!1,i.sbBroadcastEventName=i.sbBroadcastEventName||"azSuggestBoxSelect",i.sbSelectedListItemClass=i.sbSelectedListItemClass||"ng-hide",i.sbCloseListOnSelect=i.sbCloseListOnSelect||!1,i.weSentBroadcast=!1;var l,s,c,a,r=i.sbList.split(" ");if(3!=r.length)throw"invalid sbList attribute";c=r[0],l=r[2],i.listAlias=c,i.list=i.$parent.$eval(l);var h=i.sbModel.split(" ");if(3!=h.length)throw"invalid sbModel attribute";a=h[0],s=h[2],i.modelAlias=a,i.model=i.$parent.$eval(s),i.closeDropDown=function(){i.isOpen=!1},i.openDropDown=function(){i.isOpen=!0},i.dropDownState=function(){return i.isOpen},o(i,function(e,t){t.closeDropDown(),t.$watch("isOpen",function(){t.isOpen?n.addClass("open"):n.removeClass("open")}),n.append(e)}),i.$watchCollection("model",function(){i.sbCloseListOnSelect&&(i.closeDropDown(),i.$broadcast("clearSearch")),i.sbAllowDuplicates||i.model.forEach(function(e){i.selectListItem(e)}),i.sbOnSelectionChange()}),i.$watch("list",function(){},!0),e.onclick=function(e){var n=e.target,o=!1;do{if(n.attributes&&(n.attributes["az-suggest-box"]||n.attributes["sb-selection-item"]||n.attributes["sb-trigger-area"])){o=!0;break}n=n.parentNode}while(void 0!=n);o||t.$broadcast(i.sbBroadcastEventName)},i.$on(i.sbBroadcastEventName,function(){i.weSentBroadcast||i.closeDropDown(),i.weSentBroadcast=!1,i.$apply()})}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTriggerArea",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sendBroadcast(),e.dropDownState()?e.closeDropDown():e.openDropDown(),e.$apply()})},controller:["$rootScope","$scope",function(e,t){t.sendBroadcast=function(){t.weSentBroadcast=!0,e.$broadcast(t.sbBroadcastEventName)}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTypeAhead",[function(){return{restrict:"A",link:function(e,t,i,n){function o(){e.openDropDown();var i=t.val().toLowerCase(),n=0,o=-1;e.highlightNone();for(var l=0;l<e.list.length;l++)if(0==i.length)e.showListItem(l),n++,o=l;else{var s=e.list[l];if("object"==typeof s){for(var c in s)if(s.hasOwnProperty(c)){var a;if("string"==typeof s[c])a=s[c].toLowerCase();else{if("number"!=typeof s[c])break;a=s[c].toString()}if(a.search(new RegExp(i))>-1){e.showListItem(l),n++,o=l;break}e.hideListItem(l)}}else if("string"==typeof s){if(s.toLowerCase().search(new RegExp(i))>-1){e.showListItem(l),n++,o=l;break}e.hideListItem(l)}else if("number"==typeof s){if(s.toString().search(new RegExp(i))>-1){e.showListItem(l),n++,o=l;break}e.hideListItem(l)}}e.sbAllowDuplicates||e.model.forEach(function(t){e.selectListItem(t),o==t&&(o=-1,n=2)}),1==n&&e.highlightListItem(o)}t.on("keydown",function(i){switch(i.keyCode){case 40:e.openDropDown(),e.highlightNextItem(),i.preventDefault();break;case 38:e.highlightPrevItem(),i.preventDefault();break;case 13:case 9:if(e.highlightedItem>-1)e.toggleItemSelection(e.highlightedItem);else if(e.sbAllowFreeText)if(e.sbAllowAddItem){var n={};if(n[e.sbNewItemField]=t.val(),e.list.splice(0,0,n),1==e.sbMaxSelection)e.model.splice(0,e.model.length),e.toggleItemSelection(0);else{for(var o=0;o<e.model.length;o++)"number"==typeof e.model[o]&&e.model[o]++;e.toggleItemSelection(0)}}else e.model.push(t.val());i.preventDefault();break;case 27:e.closeDropDown(),e.$emit("clearSearch"),i.preventDefault();break;case 8:0==t.val().length&&e.unSelectListItem(e.model.pop())}e.$apply()}),t.on("input",function(){o()}),e.$on("clearSearch",function(){t.val("");for(var i=0;i<e.list.length;i++)e.showListItem(i);e.sbAllowDuplicates||e.model.forEach(function(t){e.selectListItem(t)})})}}}])}();