!function(){"use strict";angular.module("azSuggestBox",[])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbDropdownItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,s,l){var n=[],o=e.listAlias,c=t.parent();e.highlightedItem=-1,e.$watch("isOpen",function(){e.isOpen?c.removeClass("ng-hide"):c.addClass("ng-hide")}),e.$watchCollection("list",function(){for(var i=0;i<n.length;i++)n[i].clone[0].outerHTML="",n[i].scope.$destroy();n=[];for(var s=0;s<e.list.length;s++){var c=e.list[s],d=e.$new();d[o]=c,d.$index=s,d.$first=0==s,d.$last=s==e.list.length-1,l(d,function(e,i){i.hidden=!1,i.hide=function(){i.hidden||(angular.element(e).addClass("ng-hide"),i.hidden=!0)},i.show=function(){i.hidden&&(i.selected&&"ng-hide"==i.sbSelectedListItemClass||angular.element(e).removeClass("ng-hide"),i.hidden=!1)},i.selected=!1,i.select=function(){i.selected||(angular.element(e).addClass(i.sbSelectedListItemClass),i.selected=!0)},i.unSelect=function(){i.selected&&(angular.element(e).removeClass(i.sbSelectedListItemClass),i.selected=!1)},i.isSelected=function(){return i.selected},i.highlighted=!1,i.highlight=function(){i.highlighted||(angular.element(e).addClass(i.sbHighlightedListItemClass),i.highlighted=!0)},i.unHighlight=function(){i.highlighted&&(angular.element(e).removeClass(i.sbHighlightedListItemClass),i.highlighted=!1)},n.push({scope:i,clone:e}),0==i.$index?t.after(e):n[i.$index-1].clone.after(e),e.on("click",function(){i.toggleItemSelection(i.$index),i.$apply()})})}}),e.toggleItemSelection=function(t){if(e.sbCloseListOnSelect&&(e.closeDropDown(),e.highlightNone(),e.$broadcast("clearSearch")),e.sbAllowDuplicates)return e.indexes.push(t),e.model.push(e.list[t]),void(e.model[e.model.length-1].$listIndex=t);for(var i=0;i<e.indexes.length;i++)if(e.indexes[i]===t){e.indexes.splice(i,1),e.unSelectListItem(t);for(var s=0;s<e.model.length;s++)e.model[s].$listIndex==t&&e.model.splice(s,1);return}1==e.sbMaxSelection&&(e.indexes.forEach(function(t){e.unSelectListItem(t)}),e.indexes.splice(0,e.indexes.length),e.model.splice(0,e.model.length)),e.indexes.push(t),e.model.push(e.list[t]),e.model[e.model.length-1].$listIndex=t,e.highlightNone()},e.highlightNone=function(){e.highlightedItem>-1&&(n[e.highlightedItem].scope.unHighlight(),e.highlightedItem=-1)},e.hideListItem=function(t){t==e.highlightedItem&&(n[t].scope.unHighlight(),e.highlightedItem=-1),n[t].scope.hide()},e.showListItem=function(e){n[e]&&n[e].scope.show()},e.unSelectListItem=function(e){n[e].scope.unSelect()},e.selectListItem=function(t){n[t]&&(t==e.highlightedItem&&n[t].scope.unHighlight(),n[t].scope.select())},e.getSearchResultsCount=function(){for(var e=0,t=0;t<n.length;t++)n[t].scope.hidden||e++;return e},e.getListItemsCount=function(){return n.length},e.highlightListItem=function(t){e.highlightedItem>-1&&n[e.highlightedItem].scope.unHighlight(),n[t].scope.highlight(),e.highlightedItem=t},e.highlightNextItem=function(){var t=0,i=e.highlightedItem;do t++,i++,i>=n.length&&(i=0);while(t<n.length&&(n[i].scope.hidden||n[i].scope.selected&&"ng-hide"==e.sbSelectedListItemClass));n[i].scope.hidden||e.highlightListItem(i)},e.highlightPrevItem=function(){var t=0,i=e.highlightedItem;do t++,i--,-1>=i&&(i=n.length-1);while(t<n.length&&(n[i].scope.hidden||n[i].scope.selected&&"ng-hide"==e.sbSelectedListItemClass));n[i].scope.hidden||e.highlightListItem(i)}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbRemoveItemFromSelection",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sbRemoveItemFromSelection(),e.$apply()})}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbSelectionItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,s,l){var n=[],o=e.modelAlias;e.$watchCollection("model",function(){for(var i=0;i<n.length;i++)n[i].clone[0].outerHTML="",n[i].scope.$destroy();n=[];for(var s=0;s<e.model.length;s++){var c={},d=e.$new();c=e.model[s],d[o]=c,d.$index=s,d.$first=0==s,d.$last=s==e.model.length-1,l(d,function(e,i){i.sbRemoveItemFromSelection=function(){if(i[o].$listIndex){i.unSelectListItem(i[o].$listIndex);for(var e=0;e<i.indexes.length;e++)if(i[o].$listIndex==i.indexes[e]){i.indexes.splice(e,1);break}}i.model.splice(i.$index,1)},n.push({scope:i,clone:e}),0==i.$index?t.after(e):n[i.$index-1].clone.after(e)})}}),e.getSelectionCount=function(){return e.model.length}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("azSuggestBox",[function(){return{transclude:!0,restrict:"AE",scope:{listAlias:"@?sbListItemAlias",list:"=sbList",modelAlias:"@?sbModelAlias",model:"=?sbModel",indexes:"=?sbSelectedIndexes",sbMaxSelection:"=?",sbAllowDuplicates:"=?",sbAllowFreeText:"=?",sbAllowAddItem:"=?",sbNewItemField:"@?",sbSearchFieldsRaw:"@?sbSearchFields",sbKeyFieldsRaw:"@?sbKeyFields",sbSelectFirstListItem:"=?",sbBroadcastEventName:"@?",sbSelectedListItemClass:"@?",sbHighlightedListItemClass:"@?",sbCloseListOnSelect:"=?",sbOnSelectionChange:"&?",sbIsOpen:"@?"},link:function(e){e.init()},controller:["$document","$rootScope","$scope","$element","$transclude","$timeout",function(e,t,i,s,l,n){i.init=function(){if(void 0===i.list)throw"sb-list attribute must be set";i.listAlias=i.listAlias||"i",i.modelAlias=i.modelAlias||"s",i.indexes=i.indexes||[],i.model=i.model||[],i.sbMaxSelection=i.sbMaxSelection||0,i.sbAllowDuplicates=i.sbAllowDuplicates||!1,i.sbAllowFreeText=i.sbAllowFreeText||!1,i.sbAllowAddItem=i.sbAllowAddItem||!1,i.sbNewItemField=i.sbNewItemField||"name",i.sbSearchFieldsRaw=i.sbSearchFieldsRaw||!1,i.sbKeyFieldsRaw=i.sbKeyFieldsRaw||!1,i.sbSelectFirstListItem=i.sbSelectFirstListItem||!1,i.sbBroadcastEventName=i.sbBroadcastEventName||"azSuggestBoxSelect",i.sbSelectedListItemClass=i.sbSelectedListItemClass||"ng-hide",i.sbHighlightedListItemClass=i.sbHighlightedListItemClass||"sb-list-item-highlight",i.sbCloseListOnSelect=i.sbCloseListOnSelect||!1,i.sbOnSelectionChange=i.sbOnSelectionChange||function(){},i.weSentBroadcast=!1,i.sbKeyFieldsRaw?i.sbKeyFields=i.sbKeyFieldsRaw.split(" "):i.sbKeyFields=[],i.sbSearchFieldsRaw?i.sbSearchFields=i.sbSearchFieldsRaw.split(" "):i.sbSearchFields=[],i.closeDropDown=function(){i.isOpen=!1},i.openDropDown=function(){i.isOpen=!0},i.dropDownState=function(){return i.isOpen},i.closeDropDown(),i.sbIsOpen&&i.openDropDown(),i.$watch("isOpen",function(){i.isOpen?s.addClass("open"):s.removeClass("open")}),l(i,function(e,t){s.append(e)}),i.$watchCollection("list",function(){for(var e=0;e<i.list.length;e++)if("object"!=typeof i.list[e])throw"sb-list array items should be objects";if(0==i.sbKeyFields.length&&i.list.length>0)for(var t in i.list[0])i.list[0].hasOwnProperty(t)&&i.sbKeyFields.push(t);if(0==i.sbSearchFields.length&&i.list.length>0)for(var t in i.list[0])i.list[0].hasOwnProperty(t)&&i.sbSearchFields.push(t)}),i.$watchCollection("indexes",function(){if(!i.sbAllowDuplicates){for(var e=0;e<i.list.length;e++)i.unSelectListItem(e);i.indexes.forEach(function(e){i.selectListItem(e)})}for(var t=[],s=0;s<i.model.length;s++)"number"==typeof i.model[s].$listIndex&&(-1==i.indexes.indexOf(i.model[s].$listIndex)?(i.model.splice(s,1),s--):t[i.model[s].$listIndex]=!0);for(var l=0;l<i.indexes.length;l++)t[i.indexes[l]]||(i.model.push(i.list[i.indexes[l]]),i.model[i.model.length-1].$listIndex=i.indexes[l]);i.sbOnSelectionChange()}),i.$watchCollection("model",function(){for(var e=[],t=0;t<i.indexes.length;t++){for(var s=-1,l=0;l<i.model.length;l++){var n=!0;if(i.sbKeyFields.forEach(function(e){i.list[i.indexes[t]][e]!=i.model[l][e]&&(n=!1)}),n){s=l;break}}-1==s?(i.indexes.splice(t,1),t--):e[s]=!0}for(var o=0;o<i.model.length;o++)if(!e[o])if(i.model[o].$listIndex)i.indexes.push(i.model[o].$listIndex);else{for(var s=-1,c=0;c<i.list.length;c++){var n=!0,d=i.list[c],a=i.model[o];if(i.sbKeyFields.forEach(function(e){d[e]!=a[e]&&(n=!1)}),n){s=c;break}}s>-1?(i.model[o]=i.list[s],i.model[o].$listIndex=s,i.indexes.push(s)):i.model[o].$isNew=!0}}),t[i.sbBroadcastEventName]||(e.on("click",function(e){var s=e.target,l=!1;do{if(s.attributes&&(s.attributes["az-suggest-box"]||s.attributes["sb-selection-item"]||s.attributes["sb-trigger-area"])){l=!0;break}s=s.parentNode}while(void 0!=s);l||t.$broadcast(i.sbBroadcastEventName)}),t[i.sbBroadcastEventName]=!0),i.$on(i.sbBroadcastEventName,function(){i.weSentBroadcast||i.closeDropDown(),i.weSentBroadcast=!1,i.$apply()})}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTriggerArea",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sendBroadcast(),e.dropDownState()?e.closeDropDown():e.openDropDown(),e.$apply()})},controller:["$rootScope","$scope",function(e,t){t.sendBroadcast=function(){t.weSentBroadcast=!0,e.$broadcast(t.sbBroadcastEventName)}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTypeAhead",[function(){return{restrict:"A",link:function(e,t,i,s){function l(){e.openDropDown();var i=t.val().toLowerCase(),s=0,l=-1;e.highlightNone();for(var n=0;n<e.list.length;n++)if(0==i.length)e.showListItem(n),s++,l=n;else for(var o=e.list[n],c=0;c<e.sbSearchFields.length;c++){var d,a=e.sbSearchFields[c];if("string"==typeof o[a])d=o[a].toLowerCase();else{if("number"!=typeof o[a])continue;d=o[a].toString()}if(d.search(new RegExp(i))>-1){e.showListItem(n),-1==e.indexes.indexOf(n)&&(s++,l=n);break}e.hideListItem(n)}e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t),l==t&&(l=-1,s=2)}),1==s&&e.highlightListItem(l)}t.on("keydown",function(i){switch(i.keyCode){case 40:e.openDropDown(),e.highlightNextItem(),i.preventDefault();break;case 38:e.highlightPrevItem(),i.preventDefault();break;case 13:case 9:if(e.highlightedItem>-1)e.toggleItemSelection(e.highlightedItem);else if(e.sbAllowFreeText&&t.val().length>0){var s={};s[e.sbNewItemField]=t.val(),s.$isNew=!0,e.sbAllowAddItem?(e.list.splice(e.list.length,0,s),e.toggleItemSelection(e.list.length-1)):e.model.push(s)}9==i.keyCode&&(e.closeDropDown(),e.highlightNone(),e.$broadcast("clearSearch"));break;case 27:e.closeDropDown(),e.$emit("clearSearch"),e.highlightNone(),i.preventDefault();break;case 8:0==t.val().length&&e.model.length>0&&(e.model[e.model.length-1].$isNew?e.model.pop():(e.unSelectListItem(e.indexes.pop()),e.model.pop()))}e.$apply()}),t.on("input",function(){l()}),e.$on("clearSearch",function(){t.val("");for(var i=0;i<e.list.length;i++)e.showListItem(i);e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t)})})}}}])}();