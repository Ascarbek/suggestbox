!function(){"use strict";angular.module("azSuggestBox",[])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbDropdownItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,s,n){var l=[],o=e.listAlias,c=t.parent();e.highlightedItem=-1,e.$watch("isOpen",function(){e.isOpen?c.removeClass("ng-hide"):c.addClass("ng-hide")}),e.$watchCollection("list",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var s=0;s<e.list.length;s++){var c=e.list[s],d=e.$new();d[o]=c,d.$index=s,d.$first=0==s,d.$last=s==e.list.length-1,n(d,function(e,i){i.hidden=!1,i.hide=function(){i.hidden||(angular.element(e).addClass("ng-hide"),i.hidden=!0)},i.show=function(){i.hidden&&(i.selected&&"ng-hide"==i.sbSelectedListItemClass||angular.element(e).removeClass("ng-hide"),i.hidden=!1)},i.selected=!1,i.select=function(){i.selected||(angular.element(e).addClass(i.sbSelectedListItemClass),i.selected=!0)},i.unSelect=function(){i.selected&&(angular.element(e).removeClass(i.sbSelectedListItemClass),i.selected=!1)},i.isSelected=function(){return i.selected},i.highlighted=!1,i.highlight=function(){i.highlighted||(angular.element(e).addClass(i.sbHighlightedListItemClass),i.highlighted=!0)},i.unHighlight=function(){i.highlighted&&(angular.element(e).removeClass(i.sbHighlightedListItemClass),i.highlighted=!1)},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e),e.on("click",function(){i.toggleItemSelection(i.$index),i.$apply()})})}}),e.toggleItemSelection=function(t){if(e.sbAllowDuplicates)e.indexes.push(t),e.model.push(e.list[t]),e.model[e.model.length-1].$listIndex=t;else{for(var i=!1,s=0;s<e.indexes.length;s++)if(e.indexes[s]===t){e.indexes.splice(s,1),e.unSelectListItem(t),i=!0;break}if(i)for(var n=0;n<e.model.length;n++)e.model[n].$listIndex==t&&e.model.splice(n,1);i||(1==e.sbMaxSelection&&(e.indexes.forEach(function(t){e.unSelectListItem(t)}),e.indexes.splice(0,e.indexes.length),e.model.splice(0,e.model.length)),e.indexes.push(t),e.model.push(e.list[t]),e.model[e.model.length-1].$listIndex=t,e.highlightNone())}},e.highlightNone=function(){e.highlightedItem>-1&&(l[e.highlightedItem].scope.unHighlight(),e.highlightedItem=-1)},e.hideListItem=function(t){t==e.highlightedItem&&(l[t].scope.unHighlight(),e.highlightedItem=-1),l[t].scope.hide()},e.showListItem=function(e){l[e]&&l[e].scope.show()},e.unSelectListItem=function(e){l[e].scope.unSelect()},e.selectListItem=function(t){l[t]&&(t==e.highlightedItem&&l[t].scope.unHighlight(),l[t].scope.select())},e.getSearchResultsCount=function(){for(var e=0,t=0;t<l.length;t++)l[t].scope.hidden||e++;return e},e.getListItemsCount=function(){return l.length},e.highlightListItem=function(t){e.highlightedItem>-1&&l[e.highlightedItem].scope.unHighlight(),l[t].scope.highlight(),e.highlightedItem=t},e.highlightNextItem=function(){var t=0,i=e.highlightedItem;do t++,i++,i>=l.length&&(i=0);while(t<l.length&&(l[i].scope.hidden||l[i].scope.selected&&"ng-hide"==e.sbSelectedListItemClass));l[i].scope.hidden||e.highlightListItem(i)},e.highlightPrevItem=function(){var t=0,i=e.highlightedItem;do t++,i--,-1>=i&&(i=l.length-1);while(t<l.length&&(l[i].scope.hidden||l[i].scope.selected&&"ng-hide"==e.sbSelectedListItemClass));l[i].scope.hidden||e.highlightListItem(i)}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbRemoveItemFromSelection",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sbRemoveItemFromSelection(),e.$apply()})}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbSelectionItem",[function(){return{transclude:"element",restrict:"AE",link:function(e,t,i,s,n){var l=[],o=e.indexesAlias;e.$watchCollection("model",function(){for(var i=0;i<l.length;i++)l[i].clone[0].outerHTML="",l[i].scope.$destroy();l=[];for(var s=0;s<e.model.length;s++){var c={},d=e.$new();c=e.model[s],d[o]=c,d.$index=s,d.$first=0==s,d.$last=s==e.model.length-1,n(d,function(e,i){i.sbRemoveItemFromSelection=function(){if(i[o].$listIndex){i.unSelectListItem(i[o].$listIndex);for(var e=0;e<i.indexes.length;e++)if(i[o].$listIndex==i.indexes[e]){i.indexes.splice(e,1);break}}i.model.splice(i.$index,1)},l.push({scope:i,clone:e}),0==i.$index?t.after(e):l[i.$index-1].clone.after(e)})}}),e.getSelectionCount=function(){return e.model.length}}}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("azSuggestBox",[function(){return{transclude:!0,restrict:"AE",scope:{listAlias:"@sbListItemAlias",list:"=sbList",indexesAlias:"@sbModelAlias",model:"=sbModel",indexes:"=sbSelectedIndexes",sbMaxSelection:"=",sbAllowDuplicates:"=",sbAllowFreeText:"=",sbAllowAddItem:"=",sbNewItemField:"@",sbSearchFields:"@",sbSelectFirstListItem:"=",sbBroadcastEventName:"@",sbSelectedListItemClass:"@",sbHighlightedListItemClass:"@",sbCloseListOnSelect:"=",sbOnSelectionChange:"&",sbIsOpen:"@"},link:function(e){e.init()},controller:["$window","$rootScope","$scope","$element","$transclude","$timeout",function(e,t,i,s,n,l){i.init=function(){if(void 0===i.list)throw"sb-list attribute must be set";i.listAlias=i.listAlias||"i",i.indexesAlias=i.indexesAlias||"s",i.indexes=i.indexes||[],i.model=i.model||[],i.sbMaxSelection=i.sbMaxSelection||0,i.sbAllowDuplicates=i.sbAllowDuplicates||!1,i.sbAllowFreeText=i.sbAllowFreeText||!1,i.sbAllowAddItem=i.sbAllowAddItem||!1,i.sbNewItemField=i.sbNewItemField||"name",i.sbSearchFields=i.sbSearchFields||!1,i.sbSelectFirstListItem=i.sbSelectFirstListItem||!1,i.sbBroadcastEventName=i.sbBroadcastEventName||"azSuggestBoxSelect",i.sbSelectedListItemClass=i.sbSelectedListItemClass||"ng-hide",i.sbHighlightedListItemClass=i.sbHighlightedListItemClass||"sb-list-item-highlight",i.sbCloseListOnSelect=i.sbCloseListOnSelect||!1,i.weSentBroadcast=!1,i.closeDropDown=function(){i.isOpen=!1},i.openDropDown=function(){i.isOpen=!0},i.dropDownState=function(){return i.isOpen},i.closeDropDown(),i.sbIsOpen&&i.openDropDown(),i.$watch("isOpen",function(){i.isOpen?s.addClass("open"):s.removeClass("open")}),n(i,function(e,t){s.append(e)}),i.$watchCollection("list",function(){for(var e=0;e<i.list.length;e++)if("object"!=typeof i.list[e])throw"sb-list array items should be objects"}),i.$watchCollection("indexes",function(){if(i.sbCloseListOnSelect&&(i.closeDropDown(),i.highlightNone(),i.$broadcast("clearSearch")),!i.sbAllowDuplicates){for(var e=0;e<i.list.length;e++)i.unSelectListItem(e);i.indexes.forEach(function(e){i.selectListItem(e)})}for(var t=[],s=0;s<i.model.length;s++)"number"==typeof i.model[s].$listIndex&&(-1==i.indexes.indexOf(i.model[s].$listIndex)?(i.model.splice(s,1),s--):t[i.model[s].$listIndex]=!0);for(var n=0;n<i.indexes.length;n++)t[i.indexes[n]]||(i.model.push(i.list[i.indexes[n]]),i.model[i.model.length-1].$listIndex=i.indexes[n])}),i.$watchCollection("model",function(){i.sbOnSelectionChange(),i.indexes.splice(0,i.indexes.length);for(var e=0;e<i.model.length;e++){for(var t=!1,s=-1,n=0;n<i.list.length;n++){var l=!0,o=i.list[n],c=i.model[e];for(var d in o)if(o.hasOwnProperty(d)&&o[d]!==c[d]){l=!1;break}if(l){t=!0,s=n;break}}t?(i.model[e].$listIndex=s,i.indexes.push(s)):i.model[e].$isNew=!0}}),e.onclick=function(e){var s=e.target,n=!1;do{if(s.attributes&&(s.attributes["az-suggest-box"]||s.attributes["sb-selection-item"]||s.attributes["sb-trigger-area"])){n=!0;break}s=s.parentNode}while(void 0!=s);n||t.$broadcast(i.sbBroadcastEventName)},i.$on(i.sbBroadcastEventName,function(){i.weSentBroadcast||i.closeDropDown(),i.weSentBroadcast=!1,i.$apply()})}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTriggerArea",[function(){return{restrict:"AE",link:function(e,t,i){t.on("click",function(){e.sendBroadcast(),e.dropDownState()?e.closeDropDown():e.openDropDown(),e.$apply()})},controller:["$rootScope","$scope",function(e,t){t.sendBroadcast=function(){t.weSentBroadcast=!0,e.$broadcast(t.sbBroadcastEventName)}}]}}])}(),function(){"use strict";angular.module("azSuggestBox").directive("sbTypeAhead",[function(){return{restrict:"A",link:function(e,t,i,s){function n(){e.openDropDown();var i=t.val().toLowerCase(),s=0,n=-1;e.highlightNone();for(var l=0;l<e.list.length;l++)if(0==i.length)e.showListItem(l),s++,n=l;else{var o=e.list[l];if("object"==typeof o)for(var c in o)if(o.hasOwnProperty(c)){var d;if("string"==typeof o[c])d=o[c].toLowerCase();else{if("number"!=typeof o[c])continue;d=o[c].toString()}if(d.search(new RegExp(i))>-1){e.showListItem(l),-1==e.indexes.indexOf(l)&&(s++,n=l);break}e.hideListItem(l)}}e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t),n==t&&(n=-1,s=2)}),1==s&&e.highlightListItem(n)}t.on("keydown",function(i){switch(i.keyCode){case 40:e.openDropDown(),e.highlightNextItem(),i.preventDefault();break;case 38:e.highlightPrevItem(),i.preventDefault();break;case 13:case 9:if(e.highlightedItem>-1)e.toggleItemSelection(e.highlightedItem);else if(e.sbAllowFreeText&&t.val().length>0){var s={};s[e.sbNewItemField]=t.val(),s.$isNew=!0,e.sbAllowAddItem?(e.list.splice(e.list.length,0,s),e.toggleItemSelection(e.list.length-1)):e.model.push(s)}9==i.keyCode&&(e.closeDropDown(),e.highlightNone(),e.$broadcast("clearSearch"));break;case 27:e.closeDropDown(),e.$emit("clearSearch"),e.highlightNone(),i.preventDefault();break;case 8:0==t.val().length&&e.model.length>0&&(e.model[e.model.length-1].$isNew?e.model.pop():(e.unSelectListItem(e.indexes.pop()),e.model.pop()))}e.$apply()}),t.on("input",function(){n()}),e.$on("clearSearch",function(){t.val("");for(var i=0;i<e.list.length;i++)e.showListItem(i);e.sbAllowDuplicates||e.indexes.forEach(function(t){e.selectListItem(t)})})}}}])}();